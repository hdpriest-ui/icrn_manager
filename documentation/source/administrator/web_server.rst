Web Server
==========

The ICRN Kernel Manager web server provides a browser-based interface and REST API for exploring available kernels.

Prerequisites
-------------

The web server requires the JSON files generated by the kernel indexer:

- ``collated_manifests.json``
- ``package_index.json``

Building the Container
----------------------

.. code-block:: bash

   docker build -t icrn-kernel-webserver:latest -f web/Dockerfile web/

Running the Web Server
----------------------

Docker with Mounted Data
~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: bash

   docker run -d -p 8080:80 --name icrn-web \
     -v /path/to/kernel/repository:/app/data:ro \
     -e COLLATED_MANIFESTS_PATH=/app/data/collated_manifests.json \
     -e PACKAGE_INDEX_PATH=/app/data/package_index.json \
     icrn-kernel-webserver:latest

Docker with Example Data
~~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: bash

   docker run -d -p 8080:80 --name icrn-web icrn-kernel-webserver:latest
   docker cp web/examples/collated_manifests.json icrn-web:/app/data/
   docker cp web/examples/package_index.json icrn-web:/app/data/

Environment Variables
---------------------

``COLLATED_MANIFESTS_PATH``
   Path to the kernel-centric manifest file. Default: ``/app/data/collated_manifests.json``

``PACKAGE_INDEX_PATH``
   Path to the package-centric index file. Default: ``/app/data/package_index.json``

API Endpoints
-------------

The web server exposes the following REST API endpoints:

.. list-table::
   :header-rows: 1
   :widths: 30 70

   * - Endpoint
     - Description
   * - ``GET /``
     - API information and status
   * - ``GET /health``
     - Health check endpoint
   * - ``GET /api/languages``
     - List of available languages
   * - ``GET /api/kernels/{language}``
     - All kernels for a specific language
   * - ``GET /api/kernel/{language}/{kernel_name}/{version}``
     - Specific kernel details
   * - ``GET /api/manifest/{language}/{kernel_name}/{version}``
     - Package manifest for a kernel
   * - ``GET /api/package/{package_name}``
     - All kernels containing a package
   * - ``GET /api/packages/search``
     - Search for packages by name
   * - ``POST /api/refresh``
     - Manually trigger data refresh

Kubernetes Service
------------------

For the RStudio Addin to communicate with the web server, deploy it as a Kubernetes Service:

.. code-block:: yaml

   apiVersion: v1
   kind: Service
   metadata:
     name: icrn-web-service
     namespace: kernels
   spec:
     selector:
       app: icrn-web
     ports:
       - port: 80
         targetPort: 80

The RStudio Addin connects to ``http://icrn-web-service.kernels:80`` by default.

Public URLs
-----------

Configure ingress or load balancers to expose the web interface:

- **Production**: https://kernels.ncsa.illinois.edu
- **Development**: https://kernels.cori-dev.ncsa.illinois.edu

